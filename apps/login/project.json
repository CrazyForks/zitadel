{
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "namedInputs": {
    "envVars": [
      {
        "env": "DEBUG"
      },
      {
        "env": "EMAIL_VERIFICATION"
      },
      {
        "env": "AUDIENCE"
      },
      {
        "env": "SYSTEM_USER_ID"
      },
      {
        "env": "SYSTEM_USER_PRIVATE_KEY"
      },
      {
        "env": "ZITADEL_API_URL"
      },
      {
        "env": "ZITADEL_SERVICE_USER_TOKEN"
      },
      {
        "env": "NEXT_PUBLIC_BASE_PATH"
      },
      {
        "env": "CUSTOM_REQUEST_HEADERS"
      },
      {
        "env": "NODE_ENV"
      },
      {
        "env": "PORT"
      },
      {
        "env": "INKEEP_API_KEY"
      }
    ]    
  },  
  "targets": {
    "build": {
      "cache": true,
      "dependsOn": [
        "^build"
      ],
      "inputs": [
        "default",
        "envVars",
        "!{projectRoot}/.next/cache/**/*",
        "!{projectRoot}/.next/cache"
      ],
      "outputs": [
        "{projectRoot}/dist/**/*"
      ]
    },
    "build:docker": {
      "dependsOn": [
        "build"
      ],
      "inputs": [
        "docker",
        "{projectRoot}/public/**/*",
        "{projectRoot}/scripts/**/*"
      ]
    },
    "build:bake": {
      "dependsOn": [
        "build"
      ],
      "inputs": [
        "docker",
        "{projectRoot}/public/**/*",
        "{projectRoot}/scripts/**/*",
        "{projectRoot}/docker-bake.hcl",
        "{projectRoot}/docker-bake-release.hcl",
        "{workspaceRoot}/docker-bake.hcl",
        {
          "env": "META_ACTION_BAKE_FILE"
        }
      ],
      "executor": "nx:run-commands",
      "options": {
        "cwd": "{projectRoot}",
        "command": "docker buildx bake --file docker-bake.hcl --file docker-bake-release.hcl"
      }
    },
    "start:integration": {
      "continuous": true,
      "cache": false,
      "dependsOn": [
        "build"
      ]
    },
    "start:docker": {
      "continuous": true,
      "options": {
        "args": [
          "--publish",
          "3000:3000"
        ]
      }
    },
    "dev": {
      "persistent": true,
      "cache": false,
      "dependsOn": [
        "^build"
      ]
    },
    "test": {
      "dependsOn": [
        "test:unit",
        "test:integration"
      ]
    },
    "test:unit": {
      "cache": true,
      "dependsOn": [
        "^build"
      ]
    },
    "test:integration": {
      "cache": true,
      "dependsOn": [
        "@zitadel/core-mock:start:docker",
        "build",
        "start:integration"
      ],
      "inputs": [
        "{projectRoot}/integration/integration/**",
        "{projectRoot}/integration/support/**",
        "{projectRoot}/cypress.config.ts"
      ],
      "outputs": [
        "{projectRoot}/cypress/**/*"
      ]
    }
  }
}