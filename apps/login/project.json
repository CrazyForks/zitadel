{
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "targets": {
    "build": {
      "description": "Build the Next.js application in standalone mode for production. (Cache is disabled because it doesn't work https://github.com/nrwl/nx/issues/27724)",
      "cache": true,
      "dependsOn": [
        "^build"
      ],
      "inputs": [
        "default",
        "{workspaceRoot}/pnpm-lock.yaml",
        "!{projectRoot}/integration/**/*",
        "!{projectRoot}/acceptance/**/*",
        "!{projectRoot}/cypress.config.ts"
      ],
      "outputs": [
        "{projectRoot}/.next/standalone"
      ]
    },
    "start": {
      "description": "Start the standalone production build"
    },
    "build-docker": {
      "description": "Build Docker image for the login application",
      "inputs": [
        "docker"
      ],
      "dependsOn": [
        "build"
      ]
    },
    "start-docker": {
      "description": "Start the application in Docker container",
      "continuous": true,
      "options": {
        "args": [
          "--publish",
          "3000:3000"
        ]
      }
    },
    "dev": {
      "description": "Start the Next.js development server with Zitadel core backend",
      "configurations": {
        "local": {
          "dependsOn": [
            "@zitadel/core:build",
            "@zitadel/core:start-setup",
            "local-sa-token",
            "@zitadel/core:start",
            "@zitadel/console:build",
            "@zitadel/console:start"
          ]
        },
        "custom": {}
      }
    },
    "local-sa-token": {
      "description": "Create environment file with ZITADEL service user token against the local API",
      "cache": true,
      "outputs": [
        "{projectRoot}/.env.local"
      ],
      "executor": "nx:run-commands",
      "options": {
        "cwd": "{projectRoot}",
        "commands": [
          "TOKEN=$(cat ../../login-client.pat) && echo \"ZITADEL_SERVICE_USER_TOKEN=$TOKEN\" > .env.local"
        ],
        "parallel": false
      }
    },
    "check": {
      "description": "Run code quality checks (linting, formatting, testing and building)"
    },
    "lint": {
      "description": "Run all linters",
      "dependsOn": [
        "lint-check-*"
      ]
    },
    "lint-check-prettier": {
        "inputs": [
          "prettier",
          "{projectRoot}/constants/**/*",
          "{projectRoot}/src/**/*",
          "{projectRoot}/locales/**/*",
          "{projectRoot}/scripts/healthcheck.js"
        ]
    },
    "test-unit": {
      "description": "Run unit tests",
      "dependsOn": [
        "^build"
      ]
    },
    "test-integration-env": {
      "description": "Start the login and the core mock server to run the integration tests",
      "continuous": true,
      "dependsOn": [
        "@zitadel/login-core-mock:build-docker"
      ],
      "executor": "nx:run-commands",
      "options": {
        "parallel": true,
        "commands": [
          "nx run @zitadel/devcontainer:start-login-core-mock",
          "HOSTNAME=localhost nx run @zitadel/login:start"
        ]
      }
    },
    "test-integration": {
      "dependsOn": [
        "test-integration-env"
      ],
      "inputs": [
        "{projectRoot}/integration/integration/**",
        "{projectRoot}/integration/support/**",
        "{projectRoot}/cypress.config.ts",
        "{workspaceRoot}/pnpm-lock.yaml"
      ]
    }
  }
}