name: Integration test core

on: 
  workflow_call: 
    inputs:
      login_build_image:
        required: true
        type: string

jobs:

  login-integration-test:
    if: ${{ github.event_name == 'pull_request' }}
    name: login-integration-test
    runs-on: depot-ubuntu-22.04-8
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        name: Install pnpm
        with:
          version: 9.1.2+sha256.19c17528f9ca20bd442e4ca42f00f1b9808a9cb419383cd04ba32ef19322aba7
          run_install: false
      - name: Set up pnpm caching
        uses: actions/setup-node@v4
        with:
          # We don't care about the node version or anything else, we just want to set up pnpm caching
          cache: 'pnpm'
      - name: Install Dev Container CLI
        run: pnpm install -g @devcontainers/cli@0.3.0
      - name: Run Integration Tests against the Login and a Mocked Zitadel API
        run: pnpm devcontainer:integration:login
